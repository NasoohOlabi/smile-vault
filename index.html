<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>DAMA STORE - Anarchy in Your Cart</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<script src="https://unpkg.com/htmx.org@1.9.10"></script>
		<link
			href="https://fonts.googleapis.com/css2?family=Rubik+Mono+One&family=Permanent+Marker&family=Bungee&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/firetoast@2.0.3/dist/firetoast.min.css"
		/>
		<script src="https://cdn.jsdelivr.net/npm/firetoast@2.0.3/dist/firetoast.min.js"></script>
		<style>
			body {
				background: #0a0a0a;
				color: white;
				font-family: "Permanent Marker", cursive;
			}

			.btn-punk {
				background: linear-gradient(135deg, #d00000, #ff006e);
				text-transform: uppercase;
				letter-spacing: 2px;
				transition: all 0.3s;
			}

			.btn-punk:hover {
				transform: scale(1.05);
				box-shadow: 0 0 20px #ff006e;
			}

			.grunge-border {
				border: 3px solid #ff006e;
				box-shadow: 0 0 10px rgba(255, 0, 110, 0.4);
			}

			.price-tag {
				background: #ffbe0b;
				color: black;
				padding: 5px 10px;
				display: inline-block;
				font-weight: bold;
			}

			.modal-backdrop {
				background: rgba(0, 0, 0, 0.9);
			}
		</style>
	</head>
	<body class="min-h-screen">
		<header class="p-6 bg-black">
			<div class="container mx-auto flex justify-between items-center">
				<div>
					<h1
						class="text-5xl md:text-7xl text-pink-500 font-bold"
						style="font-family: 'Bungee', cursive"
					>
						DAMA STORE
					</h1>
					<p
						class="text-yellow-400 text-xl"
						style="font-family: 'Rubik Mono One', monospace"
					>
						🎸 NO RULES, NO REGRETS 🎸
					</p>
				</div>
				<button
					onclick="showOrderSummary()"
					class="btn-punk px-8 py-4 text-xl font-bold"
				>
					ORDER NOW
					<span
						id="cartCount"
						class="ml-2 bg-yellow-400 text-black px-2 py-1 rounded text-sm"
						>0</span
					>
				</button>
			</div>
		</header>

		<main class="container mx-auto px-4 py-8">
			<div class="text-center mb-8">
				<button onclick="resetAll()" class="btn-punk px-6 py-3 text-lg">
					💣 RESET ALL 💣
				</button>
			</div>

			<div
				id="productsGrid"
				class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
			></div>
		</main>

		<div
			id="orderModal"
			class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4"
		>
			<div
				class="bg-black border-4 border-pink-500 max-w-2xl w-full max-h-[80vh] overflow-y-auto relative"
			>
				<button
					onclick="closeOrderSummary()"
					class="absolute top-4 right-4 text-3xl text-pink-500"
				>
					✕
				</button>
				<div class="p-8">
					<h2 class="text-4xl text-pink-500 font-bold mb-6">
						ORDER SUMMARY
					</h2>
					<div id="orderContent" class="space-y-4"></div>

					<div class="mt-8 pt-8 border-t-2 border-pink-500">
						<div class="flex justify-between items-center mb-6">
							<span class="text-2xl font-bold text-yellow-400"
								>TOTAL:</span
							>
							<span
								id="totalPrice"
								class="text-3xl font-bold text-green-400"
								>$0.00</span
							>
						</div>

						<form
							id="orderForm"
							hx-post="https://sheetdb.io/api/v1/jog7er8l976bz"
							hx-trigger="submit"
							hx-target="#orderResponse"
							hx-swap="innerHTML"
							hx-headers='{"Content-Type": "application/json"}'
							class="space-y-4"
						>
							<input type="hidden" id="sheetData" name="data" />

							<div>
								<label class="block text-yellow-400 mb-2"
									>YOUR NAME (REBEL):</label
								>
								<input
									type="text"
									id="customerName"
									required
									class="w-full bg-gray-900 border-2 border-pink-500 px-4 py-2 text-white focus:outline-none"
									placeholder="Anarchy Anderson"
								/>
							</div>

							<div>
								<label class="block text-yellow-400 mb-2">EMAIL:</label>
								<input
									type="email"
									id="customerEmail"
									required
									class="w-full bg-gray-900 border-2 border-pink-500 px-4 py-2 text-white focus:outline-none"
									placeholder="rebel@punk.com"
								/>
							</div>

							<button
								type="submit"
								class="btn-punk w-full py-4 text-xl font-bold"
							>
								🚀 SUBMIT ORDER 🚀
							</button>
						</form>

						<div id="orderResponse" class="mt-4"></div>
					</div>
				</div>
			</div>
		</div>

		<script>
			const products = [
				{
					id: 1,
					name: "ANARCHY TEE",
					price: 29.99,
					image: "https://picsum.photos/seed/punk1/300/300",
				},
				{
					id: 2,
					name: "SAFETY PIN JACKET",
					price: 89.99,
					image: "https://picsum.photos/seed/punk2/300/300",
				},
				{
					id: 3,
					name: "RIPPED JEANS",
					price: 59.99,
					image: "https://picsum.photos/seed/punk3/300/300",
				},
				{
					id: 4,
					name: "COMBAT BOOTS",
					price: 129.99,
					image: "https://picsum.photos/seed/punk4/300/300",
				},
				{
					id: 5,
					name: "SPIKE BRACELET",
					price: 19.99,
					image: "https://picsum.photos/seed/punk5/300/300",
				},
				{
					id: 6,
					name: "LEATHER JACKET",
					price: 199.99,
					image: "https://picsum.photos/seed/punk6/300/300",
				},
				{
					id: 7,
					name: "CHAIN WALLET",
					price: 34.99,
					image: "https://picsum.photos/seed/punk7/300/300",
				},
				{
					id: 8,
					name: "SKULL TEE",
					price: 24.99,
					image: "https://picsum.photos/seed/punk8/300/300",
				},
			];

			function initializeProducts() {
				const grid = document.getElementById("productsGrid");
				grid.innerHTML = "";

				products.forEach((product) => {
					const savedQuantity =
						localStorage.getItem(`product_${product.id}`) || "0";
					const productCard = document.createElement("div");
					productCard.className = "grunge-border p-4 bg-gray-900";
					productCard.innerHTML = `
          <div class="relative">
            <img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover">
            <div class="absolute top-2 right-2"><span class="price-tag">$${product.price}</span></div>
          </div>
          <h3 class="text-xl font-bold mt-4 text-yellow-400" style="font-family: 'Rubik Mono One', monospace;">${product.name}</h3>
          <div class="mt-4 flex items-center justify-center space-x-4">
            <button onclick="updateQuantity(${product.id}, -1)" class="bg-pink-500 hover:bg-pink-600 text-black w-10 h-10 font-bold text-xl">-</button>
            <input type="number" id="qty-${product.id}" value="${savedQuantity}" min="0" max="99" onchange="setQuantity(${product.id}, this.value)" class="bg-transparent text-center text-2xl font-bold text-yellow-400 w-16 focus:outline-none" />
            <button onclick="updateQuantity(${product.id}, 1)" class="bg-green-500 hover:bg-green-600 text-black w-10 h-10 font-bold text-xl">+</button>
          </div>
        `;
					grid.appendChild(productCard);
				});
				updateCartCount();
			}

			function updateQuantity(id, change) {
				const input = document.getElementById(`qty-${id}`);
				let newValue = parseInt(input.value) + change;
				newValue = Math.max(0, Math.min(99, newValue));
				input.value = newValue;
				localStorage.setItem(`product_${id}`, newValue);
				updateCartCount();
			}

			function setQuantity(id, value) {
				const newValue = Math.max(0, Math.min(99, parseInt(value) || 0));
				document.getElementById(`qty-${id}`).value = newValue;
				localStorage.setItem(`product_${id}`, newValue);
				updateCartCount();
			}

			function updateCartCount() {
				let total = 0;
				products.forEach(
					(p) =>
						(total += parseInt(
							localStorage.getItem(`product_${p.id}`) || "0"
						))
				);
				document.getElementById("cartCount").textContent = total;
			}

			function resetAll() {
				products.forEach((p) => {
					localStorage.removeItem(`product_${p.id}`);
					const input = document.getElementById(`qty-${p.id}`);
					if (input) input.value = "0";
				});
				updateCartCount();
			}

			function showOrderSummary() {
				const modal = document.getElementById("orderModal");
				const content = document.getElementById("orderContent");
				let total = 0;
				content.innerHTML = "";

				products.forEach((product) => {
					const qty = parseInt(
						localStorage.getItem(`product_${product.id}`) || "0"
					);
					if (qty > 0) {
						const subtotal = product.price * qty;
						total += subtotal;
						const item = document.createElement("div");
						item.className =
							"flex justify-between items-center p-3 bg-gray-800";
						item.innerHTML = `<span class='text-yellow-400'>${
							product.name
						} x${qty}</span><span class='text-green-400'>$${subtotal.toFixed(
							2
						)}</span>`;
						content.appendChild(item);
					}
				});

				if (!content.innerHTML)
					content.innerHTML =
						'<p class="text-center text-gray-400 text-xl">YOUR CART IS EMPTY</p>';
				document.getElementById(
					"totalPrice"
				).textContent = `$${total.toFixed(2)}`;
				modal.classList.remove("hidden");
			}

			function closeOrderSummary() {
				document.getElementById("orderModal").classList.add("hidden");
				document.getElementById("orderResponse").innerHTML = "";
			}

			document
				.getElementById("orderForm")
				.addEventListener("htmx:configRequest", (evt) => {
					const name = document.getElementById("customerName").value;
					const email = document.getElementById("customerEmail").value;
					const timestamp = new Date().toISOString();
					let sheetData = [];

					products.forEach((p) => {
						const qty = parseInt(
							localStorage.getItem(`product_${p.id}`) || "0"
						);
						if (qty > 0)
							sheetData.push({
								Timestamp: timestamp,
								Name: name,
								Email: email,
								Item: p.name,
								Quantity: qty,
								Price: p.price,
								Subtotal: p.price * qty,
							});
					});

					evt.detail.parameters["data"] = JSON.stringify(sheetData);
				});

			document.addEventListener("htmx:afterRequest", (evt) => {
				if (
					evt.detail.successful &&
					evt.detail.xhr.responseURL.includes("sheetdb.io")
				) {
					document.getElementById(
						"orderResponse"
					).innerHTML = `<div class='bg-green-900 border border-green-500 p-4 rounded text-center'>🎉 ORDER SUBMITTED! 🎉</div>`;
					FireToast.success({
						message: "🎉 Order submitted successfully!",
						position: "top-right",
						duration: 4000,
					});
					setTimeout(() => {
						resetAll();
						closeOrderSummary();
					}, 2000);
				}
			});

			document.addEventListener("htmx:responseError", () => {
				FireToast.error({
					message: "❌ Failed to submit order.",
					position: "top-right",
					duration: 4000,
				});
			});

			document.addEventListener("DOMContentLoaded", initializeProducts);
			document.addEventListener("keydown", (e) => {
				if (e.key === "Escape") closeOrderSummary();
			});
		</script>
	</body>
</html>
